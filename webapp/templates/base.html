{% load url from future %}
{% comment %}
basic fixed width layout for roundup pages.
{% endcomment %}

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="js">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>frontpage | roundup</title>
<meta name="robots" content="index,follow">
<meta name="DC.title" content="roundup | a repository of orthologs">
<style type="text/css" media="all">
div.panel-flexible div.panel-row-1 div.panel-col-1 { width: 98%; }
div.panel-flexible div.panel-row-2 div.panel-col-1 { width: 49%; }
div.panel-flexible div.panel-row-2 div.panel-col-2 { width: 49%; }
div.panel-flexible div.panel-row-3 div.panel-col-1 { width: 98%; }
</style>

<link rel="shortcut icon" href="/static/images/bluebird_favicon.ico" type="image/x-icon">
<link type="text/css" rel="stylesheet" media="all" href="/static/css/aggregator.css">
<link type="text/css" rel="stylesheet" media="all" href="/static/css/node.css">
<link type="text/css" rel="stylesheet" media="all" href="/static/css/defaults.css">
<link type="text/css" rel="stylesheet" media="all" href="/static/css/system.css">
<link type="text/css" rel="stylesheet" media="all" href="/static/css/system-menus.css">
<link type="text/css" rel="stylesheet" media="all" href="/static/css/user.css">
<link type="text/css" rel="stylesheet" media="all" href="/static/css/content-module.css">
<link type="text/css" rel="stylesheet" media="all" href="/static/css/panels.css">
<link type="text/css" rel="stylesheet" media="all" href="/static/css/flexible.css">
<link type="text/css" rel="stylesheet" media="all" href="/static/css/style.css">
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
<script type="text/javascript" src="/static/js/sortable.js"></script> 
<!--
<script type="text/javascript" src="/static/js/roundup.js"></script>
<script type="text/javascript" src="/static/js/drupal.js"></script>
<script type="text/javascript" src="/static/js/panels.js"></script>
-->
<script type="text/javascript">
var countdownAction = function(count, interval, mainAction, intervalAction) {
  // inspired by http://www.tripwiremagazine.com/2011/04/9-cool-jquery-countdown-scripts.html
  // wait count intervals and then run mainAction().
  // in between intervals, run intervalAction(remaining), where remaining is the number of intervals that will be waited before mainAction()
  // e.g. if count == 3, then wait...intervalAction...wait...intervalAction...wait...mainAction.
  // e.g. if count == 1, then wait...mainAction.
  // e.g. if count == 0, then mainAction.
  // interval: in milliseconds.  
  // count: an integer >= 0. number of intervals before executing main action.
  if (count <= 0) {
    mainAction();
  } else {
    var countdown = setInterval(function() {
      count--;
      if (count <= 0) {
        clearInterval(countdown);
        mainAction()
      } else {
        intervalAction(count);
      }
    }, interval);
  }
};

var waitOnJob = function(job, url) {
  // waits, then checks to see if a lsf job is finished.  if so it forwards the browser to url.  otherwise it waits and checks again.
  // while waiting it makes little tickmarks so the user feels like something is happening.
  var msg = $("p#wait_msg").html();
  countdownAction(5, 1000, 
                  function() {
                    $.ajax({ "url": "{% url 'home.views.job_ready' %}",
                             data: {"job": job},
                             dataType: "json",
                             success: function(data) {
                                        if (data.ready) { window.location.replace(url); } 
                                        else { $("p#wait_msg").html(msg); waitOnJob(job, url); }
                                      },
                             error: function() { alert("callback failed for job="+job+" and url="+url); }
                           });},
                  function(remaining){$("p#wait_msg").html(function(index, oldhtml){ return oldhtml + "."; })});
}

// item: any kind of variable, possibly an array.
// returns: item if it is an array, or item wrapped in an array if it is not.
function makeIntoArray(item) {
    if ((typeof item == "object") && (item.constructor == Array)) { 
	return item;
    } else {
	return [item];
    }
}


//
// FORM UTILITY FUNCTIONS
//

// form: form element
// values: map of element name to a value or an array of values in the case of select or checkbox elements.
// goes through the form elements, assigning their value to the one mapped in values, or checking or selecting
// the element (or its option) if the values match in the case of checkboxes, radio buttons, and selects.
function setFormValues(form, values) {
  form.reset();
  for (var i = 0; i < form.elements.length; i++) {
    var elem = form.elements[i];
    var value = values[elem.name];
    if (typeof value == "undefined") {
	continue;
    }
    if (elem.type == null) {
        continue;
    } else if (elem.type == "select-one" || elem.type == "select-multiple") {
	var valueArr = makeIntoArray(value);
	for (var j = elem.options.length - 1; j >= 0; j--) {
	    if (inArray(elem.options[j].value, valueArr)) {
		elem.options[j].selected = true;
	    } else {
		elem.options[j].selected = false;
            }
        }
    } else if (elem.type == "checkbox" || elem.type == "radio") {
	var valueArr = makeIntoArray(value);
	if (inArray(elem.value, valueArr)) {
	    elem.checked = true;
	} else {
	    elem.checked = false;
        }
    } else {
	elem.value = value;
    }
  }
}

function docWindow2(url) {
    var windowName = 'windowName';
    var properties = 'toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes,copyhistory=no,width=1024,height=700';
    window.open(url, windowName, properties);
}

//Is obj in the array arr?
function inArray(obj, arr) {
  for (var i = 0; i < arr.length; i++) {
    if (arr[i] == obj) {
      return true;
    }
  }
  return false;
}
</script>


<!--[if lt IE 7]>
<style type="text/css" media="all">@import "/site/sites/all/themes/bluebird/fix-ie.css";</style>
<![endif]-->

</head>

<body class="sidebar-right">

{% include 'header.html' %}

<!-- content -->
{% if site_maintenance %}
<p class="maintenance">Roundup is currently undergoing routine maintenance.  Thank you for your patience while the site is unavailable.</p>
{% else %}
<div class="outer_content">
<div class="content">
{% block content %}Under construction.{% endblock %}
</div>
</div>
{% endif %}
<!-- end content -->

</div> <!-- wrap -->
{% include 'footer.html' %}

</div> <!-- container2 -->
</div> <!-- container -->

</body>
</html>
